@model ProductViewModel
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer LocString

<br />
<div class="container">
    <div class="row">
        <div class="col-sm-8">
            <div id="myCarousel" class="carousel slide" data-ride="carousel">
                <!-- Indicators -->
                <ol class="carousel-indicators">

                    @{int num = 0; }
                    @foreach (var file in Model.Files)
                    {
                        <li data-target="#myCarousel" data-slide-to="@num"></li>
                        num++;
                    }
                </ol>


                <!-- Wrapper for slides -->
                <div class="carousel-inner" role="listbox">

                    @{var classActive = "active"; }

                    @foreach (var file in Model.Files)
                    {
                        <div class="item @classActive">
                            <img src="../../images/min_@file.Name" alt="Image">
                            <div class="carousel-caption">
                                @*<h3>Sell $</h3>
                                    <p>Money Money.</p>*@
                            </div>
                        </div>
                        classActive = "";
                    }
                </div>

                <!-- Left and right controls -->
                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="well">
                <p><h3>@LocString["Name"]</h3> <br /> <h1> @Model.Name </h1> </p>
            </div>
            <div class="well">
                <p><h3>@LocString["Description"]</h3> <br /> @Model.Description</p>
            </div>
            <div class="well">
                <p><h3>@LocString["Price"]</h3>@(String.Format("{0:0.##}", Model.Price)) @LocString["Currency"] </p>
            </div>
            <div class="well">
                <p><h3>Miasto</h3> <br /> @Model.City</p>
            </div>
        </div>
    </div>
    <hr>


    <div class="form-horizontal">
        <h4>Dodaj do koszyka</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            <label class="control-label col-md-2">Ilosc</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.Quantity, new { htmlAttributes = new { @class = "form-control",  style = "width:70px" , @min = "1" } })
                <span asp-validation-for="Quantity" class="text-danger"></span>
            </div>

        </div>
        <div class="form-group">
            <div class="col-md-10">
                <button type="button" class="btn btn-success pull-left" onclick="addToBasket()">Dodaj do koszyka</button>
            </div>
        </div>
    </div>

</div>
<div>
    @Html.ActionLink("Back to List", "browse")
</div>

@section Scripts
{
    <script>
        getBasketQuantity();

        function getBasketQuantity() {
            $.ajax({
                url: '../../Cart/GetQuantity/',
                type: 'post',
                data: null,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response == 0) {
                        $("#notification").removeClass("fa-stack");
                        $("#notification").attr("data-count", 0);
                    } else {
                        $("#notification").addClass("fa-stack");
                        $("#notification").attr("data-count", parseInt(response));
                    }
                },
            });
        }

        function addToBasket() {


            var fd = new FormData();
            var quantity = $("#Quantity ").val();
            $.ajax({
                url: '../../Cart/Buy/@Model.Id/' + quantity,
                type: 'post',
                data: fd,
                contentType: false,
                processData: false,
                success: function (response) {
                    getBasketQuantity();

                    if (response != 0) {
                        //$("#img").attr("src", response);
                        //$(".preview img").show(); // Display image element
                    } else {
                        alert('file not uploaded');
                    }
                },
            });
        }

    </script>
}